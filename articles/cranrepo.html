<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="cranrepo">
<title>cranrepo • cranrepo</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="cranrepo">
<meta property="og:description" content="cranrepo">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">cranrepo</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/cranrepo.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mikmart/cranrepo/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>cranrepo</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mikmart/cranrepo/blob/HEAD/vignettes/cranrepo.Rmd" class="external-link"><code>vignettes/cranrepo.Rmd</code></a></small>
      <div class="d-none name"><code>cranrepo.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="set-up-a-cran-like-repository">Set up a CRAN-like repository<a class="anchor" aria-label="anchor" href="#set-up-a-cran-like-repository"></a>
</h2>
<p>cranrepo gives you the basic tools you need to set up a CRAN-like
repository. In this vignette, we’ll go through the steps you’d take to
do that.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mikmart/cranrepo" class="external-link">cranrepo</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="create-a-repository-directory">Create a repository directory<a class="anchor" aria-label="anchor" href="#create-a-repository-directory"></a>
</h3>
<p>The first step to creating a repository is to set up a directory
structure, and the <code>PACKAGES</code> files that act as the package
indexes. cranrepo has a single function to do both:
<code><a href="../reference/repo_create.html">repo_create()</a></code>.</p>
<p>Let’s set up a repository structure in a temporary location:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">repo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/repo_create.html">repo_create</a></span><span class="op">(</span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_temp.html" class="external-link">path_temp</a></span><span class="op">(</span><span class="st">"cranrepo/repos/latest"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The created directory structure contains distribution trees for all
three main types of packages: source, Windows binary, and Mac binary
packages. That ensures that our repository can be used via the
<code>file:</code> protocol without errors on any major platform without
throwing errors about missing files; something that’s of particular
usefulness when setting up an internal repository shared via a network
drive, for example.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span><span class="op">(</span><span class="va">repo</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">/tmp/RtmprBXrGF/cranrepo/repos/latest</span></span></span>
<span><span class="co">#&gt; ├── <span style="color: #0000BB; font-weight: bold;">bin</span></span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">macosx</span></span></span>
<span><span class="co">#&gt; │   │   └── <span style="color: #0000BB; font-weight: bold;">contrib</span></span></span>
<span><span class="co">#&gt; │   │       └── <span style="color: #0000BB; font-weight: bold;">4.2</span></span></span>
<span><span class="co">#&gt; │   │           ├── PACKAGES</span></span>
<span><span class="co">#&gt; │   │           ├── PACKAGES.db</span></span>
<span><span class="co">#&gt; │   │           ├── <span style="color: #BB0000; font-weight: bold;">PACKAGES.gz</span></span></span>
<span><span class="co">#&gt; │   │           └── PACKAGES.rds</span></span>
<span><span class="co">#&gt; │   └── <span style="color: #0000BB; font-weight: bold;">windows</span></span></span>
<span><span class="co">#&gt; │       └── <span style="color: #0000BB; font-weight: bold;">contrib</span></span></span>
<span><span class="co">#&gt; │           └── <span style="color: #0000BB; font-weight: bold;">4.2</span></span></span>
<span><span class="co">#&gt; │               ├── PACKAGES</span></span>
<span><span class="co">#&gt; │               ├── PACKAGES.db</span></span>
<span><span class="co">#&gt; │               ├── <span style="color: #BB0000; font-weight: bold;">PACKAGES.gz</span></span></span>
<span><span class="co">#&gt; │               └── PACKAGES.rds</span></span>
<span><span class="co">#&gt; └── <span style="color: #0000BB; font-weight: bold;">src</span></span></span>
<span><span class="co">#&gt;     └── <span style="color: #0000BB; font-weight: bold;">contrib</span></span></span>
<span><span class="co">#&gt;         ├── PACKAGES</span></span>
<span><span class="co">#&gt;         ├── PACKAGES.db</span></span>
<span><span class="co">#&gt;         ├── <span style="color: #BB0000; font-weight: bold;">PACKAGES.gz</span></span></span>
<span><span class="co">#&gt;         └── PACKAGES.rds</span></span></code></pre></div>
<p>In addition to the usual <code>PACKAGES</code> files, you’ll notice
our distribution trees contain a <code>PACKAGES.db</code> file. This is
the SQLite databse used by <a href="https://cran.r-project.org/package=cranlike" class="external-link">cranlike</a> under
the hood to manage the repository index in an efficient manner.</p>
</div>
<div class="section level3">
<h3 id="add-packages-to-your-repository">Add packages to your repository<a class="anchor" aria-label="anchor" href="#add-packages-to-your-repository"></a>
</h3>
<p>The next thing we’ll need to do is to add some packages to our
repository. Let’s get a package to insert from CRAN. We’ll get both the
source and binary bundle. It’s always good practice to serve the source
bundle from your repository, and the pre-built binary makes the package
accessible to a wider audience.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CRAN <span class="op">=</span> <span class="st">"https://cloud.r-project.org"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">src</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/download.packages.html" class="external-link">download.packages</a></span><span class="op">(</span><span class="st">"ggplot2"</span>, <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"source"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">bin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/download.packages.html" class="external-link">download.packages</a></span><span class="op">(</span><span class="st">"ggplot2"</span>, <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"win.binary"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></span></code></pre></div>
<p>Instead of getting package bundles from another repository like CRAN,
we could just as well build them for our own local package ourselves
with <code>R CMD build</code> and <code>R CMD INSTALL --build</code>.
All that matters is that we have the appropriate bundle(s) available for
inserting into our repository.</p>
<p>Now that we have some package bundles, we can add them to our
repository with <code><a href="../reference/repo_insert.html">repo_insert()</a></code>. You will, however, need to
let cranrepo know what type of bundle you are inserting. That’s one of
the deliberate design decisions made in an effort find the right level
of abstraction for the package.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/repo_insert.html">repo_insert</a></span><span class="op">(</span><span class="va">repo</span>, <span class="va">src</span>, <span class="st">"source"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/repo_insert.html">repo_insert</a></span><span class="op">(</span><span class="va">repo</span>, <span class="va">bin</span>, <span class="st">"win.binary"</span><span class="op">)</span></span></code></pre></div>
<p>We can verify that the packages were successfully inserted by
checking the available packages in our repo:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">available_packages</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">repos</span>, <span class="va">type</span> <span class="op">=</span> <span class="st">"source"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/available.packages.html" class="external-link">available.packages</a></span><span class="op">(</span>repos <span class="op">=</span> <span class="va">repos</span>, type <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Package"</span>, <span class="st">"Version"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">available_packages</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"file:"</span>, <span class="va">repo</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"source"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Package   Version </span></span>
<span><span class="co">#&gt; "ggplot2"   "3.4.0"</span></span>
<span><span class="fu">available_packages</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"file:"</span>, <span class="va">repo</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"binary"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Package   Version </span></span>
<span><span class="co">#&gt; "ggplot2"   "3.4.0"</span></span></code></pre></div>
<p>Congratulations! You’ve set up your own CRAN-like repository serving
source and binary packages. That said, there’s still some operations
you’ll need in order to manage the lifecycle of a package
repository.</p>
</div>
<div class="section level3">
<h3 id="serving-your-repository-over-http">Serving your repository over HTTP<a class="anchor" aria-label="anchor" href="#serving-your-repository-over-http"></a>
</h3>
<p>Earlier, we accessed our repository from our local computer using the
<code>file:</code> protocol. Unless your repository was created on a
network location, chances are that other users won’t be able to access
the repository this way. Instead, you’ll need to either move the
repository to a network location, or serve the files over a web protocol
like HTTP. cranrepo provides a convenience function,
<code><a href="../reference/repo_serve.html">repo_serve()</a></code>, which can be used to start a simple HTTP
server on your PC to let others access our repository.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/repo_serve.html">repo_serve</a></span><span class="op">(</span><span class="va">repo</span><span class="op">)</span></span></code></pre></div>
<p>By default, the repository is served on port 4321. We can check the
available packages again, from another R session:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">available_packages</span><span class="op">(</span><span class="st">"http://localhost:4321"</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="../reference/repo_serve.html">repo_serve()</a></code> is mainly provided for convenience and
testing purposes when developing a repository. When actually publishing
a repository for you consumers, it’s like you’d have a different
solution for hosting the repository as e.g. static files.</p>
<p>You now have the basics to set up a repository, add packages, and
distribute them to collaborators. Next, let’s tackle a few admin
tasks.</p>
</div>
<div class="section level3">
<h3 id="removing-a-package">Removing a package<a class="anchor" aria-label="anchor" href="#removing-a-package"></a>
</h3>
<p>Sometimes (hopefully rarely) you’ll realize you added a package to
your repository that you really shouldn’t have. To recover and remove
the package, <code><a href="../reference/repo_remove.html">repo_remove()</a></code> comes to your aid. Let’s remove
all the versions of ggplot2 Windows binaries from our repository,
including the one we added earlier:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">removed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/repo_remove.html">repo_remove</a></span><span class="op">(</span><span class="va">repo</span>, <span class="st">"ggplot2"</span>, version <span class="op">=</span> <span class="cn">NULL</span>, type <span class="op">=</span> <span class="st">"win.binary"</span><span class="op">)</span></span></code></pre></div>
<p>For transparency, we get back the paths to the files that were
removed:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">removed</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000; font-weight: bold;">/tmp/RtmprBXrGF/cranrepo/repos/latest/bin/windows/contrib/4.2/ggplot2_3.4.0.zip</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="updating-the-package-index">Updating the package index<a class="anchor" aria-label="anchor" href="#updating-the-package-index"></a>
</h3>
<p>If you make external changes to the package repository, you may end
up with a situation where the package index is out of sync with the
actual files in the repository. For example, let’s manually delete the
source bundle of ggplot2 we added earlier:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/delete.html" class="external-link">file_delete</a></span><span class="op">(</span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="va">repo</span>, <span class="st">"src/contrib"</span>, <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path_file.html" class="external-link">path_file</a></span><span class="op">(</span><span class="va">src</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The repository still reports the package as being available:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">available_packages</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"file:"</span>, <span class="va">repo</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Package   Version </span></span>
<span><span class="co">#&gt; "ggplot2"   "3.4.0"</span></span></code></pre></div>
<p>We’ll need to call <code><a href="../reference/repo_update.html">repo_update()</a></code> to bring the package
index up to date, and report to our consumers that the package is no
longer available:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/repo_update.html">repo_update</a></span><span class="op">(</span><span class="va">repo</span>, <span class="st">"source"</span><span class="op">)</span></span>
<span><span class="fu">available_packages</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"file:"</span>, <span class="va">repo</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Package Version</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h3>
<p>To wrap up, let’s clean up the files we created for this
vignette:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/delete.html" class="external-link">dir_delete</a></span><span class="op">(</span><span class="va">repo</span><span class="op">)</span></span></code></pre></div>
<p>There we go! You now have the basic tools and knowledge to set up and
manage your own CRAN-like repository. Use them wisely.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Mikko Marttila.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
